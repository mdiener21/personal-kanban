(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function o(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(a){if(a.ep)return;a.ep=!0;const r=o(a);fetch(a.href,r)}})();function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}const we="kanbanBoards",q="kanbanActiveBoardId",Fe="kanbanColumns",Ye="kanbanTasks",Ke="kanbanLabels",L="default",M=new Map;function A(){return new Date().toISOString()}function b(e,n){return`kanbanBoard:${e}:${n}`}function P(e){if(!e)return null;try{const n=JSON.parse(e);return Array.isArray(n)?n:null}catch{return null}}function C(){const e=P(localStorage.getItem(we));return e?e.filter(n=>n&&typeof n.id=="string").map(n=>({id:n.id,name:typeof n.name=="string"?n.name:"Untitled board",createdAt:typeof n.createdAt=="string"?n.createdAt:void 0})):[]}function je(e){const n=typeof e=="string"?e:"";return n&&C().find(o=>o.id===n)||null}function De(){const e=B(),n=e?je(e):null;return(typeof(n==null?void 0:n.name)=="string"?n.name.trim():"")||"Untitled board"}function te(e){localStorage.setItem(we,JSON.stringify(e))}function B(){var o;const e=localStorage.getItem(q),n=C();return e&&n.some(t=>t.id===e)?e:((o=n[0])==null?void 0:o.id)||null}function G(e){const n=typeof e=="string"?e:"";!n||!C().some(t=>t.id===n)||localStorage.setItem(q,n)}function me(){return[{id:"todo",name:"To Do",color:"#3b82f6"},{id:"inprogress",name:"In Progress",color:"#f59e0b"},{id:"done",name:"Done",color:"#16a34a"}]}function fe(){return[{id:"urgent",name:"Urgent",color:"#ef4444"},{id:"feature",name:"Feature",color:"#3b82f6"},{id:"task",name:"Task",color:"#f59e0b"}]}function Te(){return[{id:w(),title:"Find out where the Soul Stone is",description:"Identify current location and access requirements.",priority:"high",dueDate:"",column:"todo",labels:["urgent"],creationDate:A()},{id:w(),title:"Collect the Time Stone",description:"Coordinate with Dr. Strange and plan retrieval.",priority:"medium",dueDate:"",column:"inprogress",labels:["feature"],creationDate:A()},{id:w(),title:"Collect the Mind Stone",description:"Determine safe extraction approach.",priority:"medium",dueDate:"",column:"inprogress",labels:[],creationDate:A()},{id:w(),title:"Collect the Reality Stone",description:"Negotiate with the Collector, avoid escalation.",priority:"low",dueDate:"",column:"inprogress",labels:["task"],creationDate:A()},{id:w(),title:"Collect the Power Stone",description:"Verify secure containment after retrieval.",priority:"high",dueDate:"",column:"done",labels:["urgent","feature"],creationDate:A()},{id:w(),title:"Collect the Space Stone",description:"",priority:"low",dueDate:"",column:"done",labels:[],creationDate:A()}]}function We(){const e=P(localStorage.getItem(Fe)),n=P(localStorage.getItem(Ye)),o=P(localStorage.getItem(Ke)),t=!!(e||n||o),a=[{id:L,name:"Default Board",createdAt:A()}];return te(a),localStorage.setItem(q,L),localStorage.setItem(b(L,"columns"),JSON.stringify(e||me())),localStorage.setItem(b(L,"tasks"),JSON.stringify(n||Te())),localStorage.setItem(b(L,"labels"),JSON.stringify(o||fe())),t}function h(){const e=C();if(e.length>0){B()||G(e[0].id);return}We()}function Ge(e){h();const o=(typeof e=="string"?e.trim():"")||"Untitled board",t=C(),a=`board-${w()}`,r={id:a,name:o,createdAt:A()};return te([...t,r]),localStorage.setItem(b(a,"columns"),JSON.stringify(me())),localStorage.setItem(b(a,"tasks"),JSON.stringify([])),localStorage.setItem(b(a,"labels"),JSON.stringify(fe())),localStorage.setItem(q,a),r}function Xe(e,n){h();const o=typeof e=="string"?e:"",t=typeof n=="string"?n.trim():"";if(!o||!t)return!1;const a=C();if(!a.some(d=>d.id===o))return!1;const r=a.map(d=>d.id===o?{...d,name:t}:d);return te(r),!0}function Qe(e){h();const n=typeof e=="string"?e:"";if(!n)return!1;const o=C();if(!o.some(r=>r.id===n)||o.length<=1)return!1;const t=o.filter(r=>r.id!==n);return te(t),localStorage.removeItem(b(n,"columns")),localStorage.removeItem(b(n,"tasks")),localStorage.removeItem(b(n,"labels")),M.delete(n),localStorage.getItem(q)===n&&localStorage.setItem(q,t[0].id),!0}function Ze(e){return typeof e=="string"&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(e.trim())}function et(e){return e==="todo"?"#3b82f6":e==="inprogress"?"#f59e0b":e==="done"?"#16a34a":"#3b82f6"}function he(e){const n=Ze(e==null?void 0:e.color)?e.color.trim():et(e==null?void 0:e.id);return{...e,color:n}}function x(){h();const e=B()||L,n=localStorage.getItem(b(e,"columns")),o=P(n);return o?o.map(he):me().map(he)}function V(e){h();const n=B()||L;localStorage.setItem(b(n,"columns"),JSON.stringify(e))}function D(){h();const e=B()||L,n=localStorage.getItem(b(e,"tasks")),o=P(n);if(o)return M.set(e,o),o;const t=M.get(e);if(Array.isArray(t))return t;const a=Te();return M.set(e,a),a}function N(e){h();const n=B()||L;localStorage.setItem(b(n,"tasks"),JSON.stringify(e)),M.set(n,e)}function I(){h();const e=B()||L,n=localStorage.getItem(b(e,"labels")),o=P(n);return o||fe()}function ne(e){h();const n=B()||L;localStorage.setItem(b(n,"labels"),JSON.stringify(e))}const tt=new Set(["low","medium","high"]);function Ae(e){const n=(e||"").toString().trim().toLowerCase();return tt.has(n)?n:"medium"}function _e(e){return(e||"").toString().trim()}function nt(e,n,o,t,a,r=[]){if(!e||e.trim()==="")return;const d=D(),l=d.filter(u=>u.column===a).reduce((u,c)=>Math.max(u,c.order??0),0),i={id:w(),title:e.trim(),description:(n||"").toString().trim(),priority:Ae(o),dueDate:_e(t),column:a,order:l+1,labels:[...r],creationDate:new Date().toISOString()};d.push(i),N(d)}function ot(e,n,o,t,a,r,d=[]){if(!n||n.trim()==="")return;const s=D(),l=s.findIndex(i=>i.id===e);l!==-1&&(s[l].title=n.trim(),s[l].description=(o||"").toString().trim(),s[l].priority=Ae(t),s[l].dueDate=_e(a),s[l].column=r,s[l].labels=[...d],N(s))}function at(e){const o=D().filter(t=>t.id!==e);return N(o),!0}function rt(){const e=[];return document.querySelectorAll(".task-column").forEach(n=>{const o=n.dataset.column;n.querySelectorAll(".task").forEach(t=>{e.push({id:t.dataset.taskId,column:o})})}),e}function dt(){const e=rt(),o=D().map(t=>{const a=e.findIndex(r=>r.id===t.id);if(a!==-1){const r=e[a],d=e.filter((s,l)=>s.column===r.column&&l<=a);return{...t,column:r.column,order:d.length}}return t});N(o)}function st(e){return typeof e=="string"&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(e.trim())}function Oe(e){return st(e)?e.trim():"#3b82f6"}function lt(e,n){if(!e||e.trim()==="")return;const o=x(),t=o.reduce((d,s)=>Math.max(d,s.order??0),0),r={id:e.toLowerCase().replace(/\s+/g,"-")+"-"+w().substring(0,8),name:e.trim(),color:Oe(n),order:t+1};o.push(r),V(o)}function it(e,n,o){if(!n||n.trim()==="")return;const t=x(),a=t.findIndex(r=>r.id===e);a!==-1&&(t[a].name=n.trim(),t[a].color=Oe(o),V(t))}function ct(e){const n=x();if(n.length<=1)return!1;const o=D();if(o.filter(r=>r.column===e).length>0){const r=o.filter(d=>d.column!==e);N(r)}const a=n.filter(r=>r.id!==e);return V(a),!0}function ut(){const n=document.getElementById("board-container").querySelectorAll(".task-column"),o=x();n.forEach((t,a)=>{const r=t.dataset.column,d=o.find(s=>s.id===r);d&&(d.order=a+1)}),V(o)}const mt="modulepreload",ft=function(e){return"/"+e},ve={},_=function(n,o,t){let a=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),s=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));a=Promise.allSettled(o.map(l=>{if(l=ft(l),l in ve)return;ve[l]=!0;const i=l.endsWith(".css"),u=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":mt,i||(c.as="script"),c.crossOrigin="",c.href=l,s&&c.setAttribute("nonce",s),document.head.appendChild(c),i)return new Promise((f,m)=>{c.addEventListener("load",f),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(d){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=d,window.dispatchEvent(s),!s.defaultPrevented)throw d}return a.then(d=>{for(const s of d||[])s.status==="rejected"&&r(s.reason);return n().catch(r)})};function pt(e,n){if(!e||e.trim()==="")return;const o=I(),a={id:e.toLowerCase().replace(/\s+/g,"-")+"-"+w().substring(0,8),name:e.trim(),color:n};return o.push(a),ne(o),a}function gt(e,n,o){if(!n||n.trim()==="")return;const t=I(),a=t.findIndex(r=>r.id===e);a!==-1&&(t[a].name=n.trim(),t[a].color=o,ne(t))}function yt(e){const n=I(),o=D();o.forEach(a=>{a.labels&&(a.labels=a.labels.filter(r=>r!==e))}),N(o);const t=n.filter(a=>a.id!==e);ne(t)}let X=null;function k(e){return document.getElementById(e)}function F(e){const n=k("dialog-modal");n&&n.classList.add("hidden");const o=X;X=null,typeof o=="function"&&o(!!e)}function bt(){const e=k("dialog-modal");return e&&!e.classList.contains("hidden")}function Pe({title:e,message:n,confirmText:o,cancelText:t,showCancel:a}){const r=k("dialog-modal-title"),d=k("dialog-modal-message"),s=k("dialog-confirm-btn"),l=k("dialog-cancel-btn");r&&(r.textContent=e||"Confirm"),d&&(d.textContent=n||""),s&&(s.textContent=o||"OK"),l&&(l.textContent=t||"Cancel"),l&&(l.style.display=a?"inline-flex":"none")}function Ne(){const e=k("dialog-modal");if(!e||e.dataset.handlersAttached==="true")return;e.dataset.handlersAttached="true";const n=k("dialog-confirm-btn"),o=k("dialog-cancel-btn"),t=e.querySelector(".modal-backdrop");n==null||n.addEventListener("click",()=>F(!0)),o==null||o.addEventListener("click",()=>F(!1)),t==null||t.addEventListener("click",()=>F(!1)),document.addEventListener("keydown",a=>{a.key==="Escape"&&bt()&&F(!1)})}function qe(){const e=k("dialog-modal");if(!e)return;e.classList.remove("hidden");const n=k("dialog-confirm-btn");n==null||n.focus()}function oe({title:e="Confirm",message:n="",confirmText:o="Delete",cancelText:t="Cancel"}={}){return Ne(),Pe({title:e,message:n,confirmText:o,cancelText:t,showCancel:!0}),qe(),new Promise(a=>{X=a})}function $e({title:e="Notice",message:n="",okText:o="OK"}={}){return Ne(),Pe({title:e,message:n,confirmText:o,cancelText:"",showCancel:!1}),qe(),new Promise(t=>{X=()=>t(!0)})}let Le="todo",z=null,H=null,Q=null,Z=null,E=[];function Et(){const e=document.getElementById("task-label-search");return((e==null?void 0:e.value)||"").trim().toLowerCase()}function ce(){const e=document.getElementById("task-active-labels");if(!e)return;const n=I(),o=[];for(const a of E)o.includes(a)||o.push(a);E=o;const t=o.map(a=>n.find(r=>r.id===a)).filter(Boolean);e.innerHTML="",e.style.display=t.length>0?"flex":"none",t.forEach(a=>{const r=document.createElement("span");r.classList.add("task-label"),r.style.backgroundColor=a.color,r.textContent=a.name;const d=document.createElement("button");d.type="button",d.classList.add("active-label-remove"),d.setAttribute("aria-label",`Remove label ${a.name}`),d.title="Remove label",d.textContent="Ã—",d.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),E=E.filter(l=>l!==a.id),ce(),ae()}),r.appendChild(d),e.appendChild(r)})}function ht(e){var u;Le=e||((u=x()[0])==null?void 0:u.id)||"todo",z=null,E=[];const n=document.getElementById("task-modal"),o=document.getElementById("task-column"),t=document.getElementById("task-title"),a=document.getElementById("task-description"),r=document.getElementById("task-priority"),d=document.getElementById("task-due-date"),s=document.getElementById("task-modal-title"),l=document.getElementById("task-submit-btn");s.textContent="Add New Task",l.textContent="Add Task",o.value=Le,t.value="",a.value="",r&&(r.value="medium"),d&&(d.value="");const i=document.getElementById("task-label-search");i&&(i.value=""),ae(),n.classList.remove("hidden"),t.focus()}function re(e){const o=D().find(g=>g.id===e);if(!o)return;z=e,E=o.labels||[];const t=document.getElementById("task-modal"),a=document.getElementById("task-column"),r=document.getElementById("task-title"),d=document.getElementById("task-description"),s=document.getElementById("task-priority"),l=document.getElementById("task-due-date"),i=document.getElementById("task-modal-title"),u=document.getElementById("task-submit-btn");i.textContent="Edit Task",u.textContent="Save Changes",a.value=o.column;const c=typeof o.text=="string"?o.text:"";r.value=typeof o.title=="string"&&o.title.trim()!==""?o.title:c,d.value=typeof o.description=="string"?o.description:"",s&&(s.value=typeof o.priority=="string"?o.priority:"medium");const f=typeof o.dueDate=="string"?o.dueDate:"",m=f.includes("T")?f.slice(0,10):f;l&&(l.value=m);const p=document.getElementById("task-label-search");p&&(p.value=""),ae(),t.classList.remove("hidden"),r.focus()}function Y(){document.getElementById("task-modal").classList.add("hidden"),z=null}function vt(){H=null;const e=document.getElementById("column-modal"),n=document.getElementById("column-name"),o=document.getElementById("column-color"),t=document.getElementById("column-modal-title"),a=document.getElementById("column-submit-btn");t.textContent="Add New Column",a.textContent="Add Column",n.value="",o&&(o.value="#3b82f6"),e.classList.remove("hidden"),n.focus()}function Lt(e){const o=x().find(l=>l.id===e);if(!o)return;H=e;const t=document.getElementById("column-modal"),a=document.getElementById("column-name"),r=document.getElementById("column-color"),d=document.getElementById("column-modal-title"),s=document.getElementById("column-submit-btn");d.textContent="Edit Column",s.textContent="Save Changes",a.value=o.name,r&&(r.value=o.color||"#3b82f6"),t.classList.remove("hidden"),a.focus()}function K(){document.getElementById("column-modal").classList.add("hidden"),H=null}function kt(){pe(),document.getElementById("labels-modal").classList.remove("hidden")}function de(){document.getElementById("labels-modal").classList.add("hidden")}function It(){document.getElementById("help-modal").classList.remove("hidden")}function se(){document.getElementById("help-modal").classList.add("hidden")}function Re(e=null){Q=e;const n=document.getElementById("label-modal"),o=document.getElementById("label-modal-title"),t=document.getElementById("label-name"),a=document.getElementById("label-color"),r=document.getElementById("label-submit-btn");if(e){const s=I().find(l=>l.id===e);s&&(o.textContent="Edit Label",r.textContent="Update Label",t.value=s.name,a.value=s.color)}else o.textContent="Add Label",r.textContent="Add Label",t.value="",a.value="#3b82f6";n.classList.remove("hidden"),t.focus()}function j(){document.getElementById("label-modal").classList.add("hidden"),Q=null}function pe(){const e=document.getElementById("labels-list");e.innerHTML="",I().forEach(o=>{const t=document.createElement("div");t.classList.add("label-item"),t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="space-between";const a=document.createElement("span");a.classList.add("task-label"),a.style.backgroundColor=o.color,a.textContent=o.name;const r=document.createElement("div");r.classList.add("label-actions"),r.style.display="flex",r.style.gap="4px";const d=document.createElement("button");d.classList.add("btn-small");const s=document.createElement("span");s.dataset.lucide="pencil",d.appendChild(s),d.title="Edit label",d.addEventListener("click",()=>Re(o.id));const l=document.createElement("button");l.classList.add("btn-small","btn-danger");const i=document.createElement("span");i.dataset.lucide="trash-2",l.appendChild(i),l.title="Delete label",l.addEventListener("click",async()=>{if(await oe({title:"Delete Label",message:`Delete label "${o.name}"? This will remove it from all tasks.`,confirmText:"Delete"})){yt(o.id),pe();const{renderBoard:c}=await _(async()=>{const{renderBoard:f}=await Promise.resolve().then(()=>O);return{renderBoard:f}},void 0);c()}}),r.appendChild(d),r.appendChild(l),t.appendChild(a),t.appendChild(r),e.appendChild(t)}),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons()}function ue(){const e=document.getElementById("board-select");if(!e)return;const n=C(),o=B();e.innerHTML="",n.forEach(a=>{const r=document.createElement("option");r.value=a.id,r.textContent=typeof a.name=="string"&&a.name.trim()?a.name.trim():"Untitled board",e.appendChild(r)}),o&&(e.value=o);const t=document.getElementById("brand-text")||document.querySelector(".brand-text");t&&(t.textContent=De())}function ee(){h();const e=document.getElementById("boards-list");if(!e)return;e.innerHTML="";const n=C(),o=B();n.forEach(t=>{const a=document.createElement("div");a.classList.add("label-item"),a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="space-between",a.style.gap="10px";const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="8px";const d=document.createElement("span");if(d.textContent=(t.name||"").toString(),r.appendChild(d),t.id===o){const m=document.createElement("span");m.classList.add("task-label"),m.style.backgroundColor="var(--color-primary)",m.textContent="Active",r.appendChild(m)}const s=document.createElement("div");s.classList.add("label-actions"),s.style.display="flex",s.style.gap="4px";const l=document.createElement("button");l.classList.add("btn-small"),l.textContent="Open",l.title="Open board",l.addEventListener("click",async()=>{G(t.id),ue(),ee();const{renderBoard:m}=await _(async()=>{const{renderBoard:p}=await Promise.resolve().then(()=>O);return{renderBoard:p}},void 0);m()});const i=document.createElement("button");i.classList.add("btn-small");const u=document.createElement("span");u.dataset.lucide="pencil",i.appendChild(u),i.title="Rename board",i.addEventListener("click",()=>Bt(t.id));const c=document.createElement("button");c.classList.add("btn-small","btn-danger");const f=document.createElement("span");f.dataset.lucide="trash-2",c.appendChild(f),c.title="Delete board",c.addEventListener("click",async()=>{if(!await oe({title:"Delete Board",message:`Do you really want to delete the board "${t.name}"? This cannot be undone.`,confirmText:"Delete"}))return;if(!Qe(t.id)){await $e({title:"Unable to Delete",message:"Unable to delete board (you may be trying to delete the last board)."});return}ue(),ee();const{renderBoard:g}=await _(async()=>{const{renderBoard:S}=await Promise.resolve().then(()=>O);return{renderBoard:S}},void 0);g(),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons()}),s.appendChild(l),s.appendChild(i),s.appendChild(c),a.appendChild(r),a.appendChild(s),e.appendChild(a)}),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons()}function Ct(){ee();const e=document.getElementById("boards-modal");e==null||e.classList.remove("hidden")}function le(){const e=document.getElementById("boards-modal");e==null||e.classList.add("hidden")}function Bt(e){h();const n=C().find(d=>d.id===e);if(!n)return;Z=e;const o=document.getElementById("board-rename-modal"),t=document.getElementById("board-rename-name"),a=document.getElementById("board-rename-modal-title"),r=document.getElementById("board-rename-submit-btn");a&&(a.textContent="Rename Board"),r&&(r.textContent="Save"),t&&(t.value=(n.name||"").toString()),o==null||o.classList.remove("hidden"),t==null||t.focus()}function W(){const e=document.getElementById("board-rename-modal");e==null||e.classList.add("hidden"),Z=null}function ae(){ce();const e=document.getElementById("task-labels-selection");e.innerHTML="";const n=Et(),o=I(),t=n?o.filter(a=>{const r=(a.name||"").toLowerCase(),d=(a.id||"").toLowerCase();return r.includes(n)||d.includes(n)}):o;if(t.length===0){const a=document.createElement("div");a.classList.add("labels-empty"),a.textContent="No matching labels",e.appendChild(a);return}t.forEach(a=>{const r=document.createElement("label");r.classList.add("label-checkbox");const d=document.createElement("input");d.type="checkbox",d.value=a.id,d.checked=E.includes(a.id),d.addEventListener("change",l=>{l.target.checked?E.includes(a.id)||E.push(a.id):E=E.filter(i=>i!==a.id),ce()});const s=document.createElement("span");s.classList.add("task-label","label-color-swatch"),s.style.backgroundColor=a.color,s.textContent=a.name,r.appendChild(d),r.appendChild(s),e.appendChild(r)})}function xt(){var n,o,t,a,r,d;const e=document.getElementById("task-label-search");e==null||e.addEventListener("input",ae),document.getElementById("task-form").addEventListener("submit",async s=>{var p,g;s.preventDefault();const l=document.getElementById("task-title").value,i=document.getElementById("task-description").value,u=(p=document.getElementById("task-priority"))==null?void 0:p.value,c=(g=document.getElementById("task-due-date"))==null?void 0:g.value,f=document.getElementById("task-column").value;z?ot(z,l,i,u,c,f,E):nt(l,i,u,c,f,E),Y();const{renderBoard:m}=await _(async()=>{const{renderBoard:S}=await Promise.resolve().then(()=>O);return{renderBoard:S}},void 0);m()}),document.getElementById("cancel-task-btn").addEventListener("click",Y),document.querySelector("#task-modal .modal-backdrop").addEventListener("click",Y),document.getElementById("column-form").addEventListener("submit",async s=>{var c;s.preventDefault();const l=document.getElementById("column-name").value,i=(c=document.getElementById("column-color"))==null?void 0:c.value;H?it(H,l,i):lt(l,i),K();const{renderBoard:u}=await _(async()=>{const{renderBoard:f}=await Promise.resolve().then(()=>O);return{renderBoard:f}},void 0);u()}),document.getElementById("cancel-column-btn").addEventListener("click",K),document.querySelector("#column-modal .modal-backdrop").addEventListener("click",K),document.getElementById("manage-labels-btn").addEventListener("click",kt),document.getElementById("labels-close-btn").addEventListener("click",de),document.getElementById("add-label-btn").addEventListener("click",()=>Re()),document.getElementById("label-form").addEventListener("submit",async s=>{s.preventDefault();const l=document.getElementById("label-name").value,i=document.getElementById("label-color").value;Q?gt(Q,l,i):pt(l,i),j(),pe();const{renderBoard:u}=await _(async()=>{const{renderBoard:c}=await Promise.resolve().then(()=>O);return{renderBoard:c}},void 0);u()}),document.getElementById("cancel-label-btn").addEventListener("click",j),document.querySelector("#labels-modal .modal-backdrop").addEventListener("click",de),document.querySelector("#label-modal .modal-backdrop").addEventListener("click",j),(n=document.getElementById("manage-boards-btn"))==null||n.addEventListener("click",Ct),(o=document.getElementById("boards-close-btn"))==null||o.addEventListener("click",le),(t=document.querySelector("#boards-modal .modal-backdrop"))==null||t.addEventListener("click",le),(a=document.getElementById("board-rename-form"))==null||a.addEventListener("submit",s=>{if(s.preventDefault(),!Z)return;const l=document.getElementById("board-rename-name"),i=((l==null?void 0:l.value)||"").trim();if(!i){alert("Board name cannot be empty.");return}if(!Xe(Z,i)){alert("Unable to rename board.");return}W(),ue(),ee(),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons()}),(r=document.getElementById("cancel-board-rename-btn"))==null||r.addEventListener("click",W),(d=document.querySelector("#board-rename-modal .modal-backdrop"))==null||d.addEventListener("click",W),document.getElementById("help-btn").addEventListener("click",It),document.getElementById("help-close-btn").addEventListener("click",se),document.querySelector("#help-modal .modal-backdrop").addEventListener("click",se),document.getElementById("add-column-btn").addEventListener("click",vt),document.addEventListener("keydown",s=>{s.key==="Escape"&&(Y(),K(),de(),j(),le(),W(),se())})}function St(){document.querySelectorAll(".task").forEach(n=>{n.addEventListener("dragstart",o=>{n.id="dragged-task",o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("task","")}),n.addEventListener("dragend",o=>{n.removeAttribute("id")})})}function wt(){document.querySelectorAll(".task-column").forEach(n=>{n.addEventListener("dragover",o=>{o.dataTransfer.types.includes("task")?Tt(o):o.dataTransfer.types.includes("column")&&Me(o)}),n.addEventListener("dragleave",o=>{if(n.contains(o.relatedTarget))return;const t=n.querySelector(".placeholder");t==null||t.remove()}),n.addEventListener("drop",async o=>{o.preventDefault();const t=document.getElementById("dragged-task"),a=n.querySelector(".placeholder");if(!t||!a)return;const r=n.querySelector(".tasks");t.remove(),r.insertBefore(t,a),a.remove(),dt();const{renderBoard:d}=await _(async()=>{const{renderBoard:s}=await Promise.resolve().then(()=>O);return{renderBoard:s}},void 0);d()})})}function Dt(){const e=document.querySelectorAll(".task-column"),n=document.getElementById("board-container");e.forEach(o=>{const t=o.querySelector(".column-drag-handle");o.draggable=!1,t.addEventListener("mousedown",()=>{o.draggable=!0}),document.addEventListener("mouseup",()=>{o.draggable=!1}),o.addEventListener("dragstart",a=>{a.target.closest(".task")||(o.id="dragged-column",a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("column",""))}),o.addEventListener("dragend",()=>{o.removeAttribute("id"),o.draggable=!1;const a=n.querySelector(".column-placeholder");a==null||a.remove()})}),n.addEventListener("dragover",o=>{o.dataTransfer.types.includes("column")&&(o.preventDefault(),Me(o))}),n.addEventListener("drop",o=>{if(!o.dataTransfer.types.includes("column"))return;o.preventDefault();const t=document.getElementById("dragged-column"),a=n.querySelector(".column-placeholder");!t||!a||(n.insertBefore(t,a),a.remove(),ut())})}function ke(e){const n=document.createElement("li");return n.classList.add("placeholder"),n.style.height=`${e.offsetHeight}px`,n}function Tt(e){if(!e.dataTransfer.types.includes("task"))return;e.preventDefault();const n=document.getElementById("dragged-task"),o=e.currentTarget,t=o.querySelector(".tasks"),a=o.querySelector(".placeholder");if(a){const r=a.getBoundingClientRect();if(r.top<=e.clientY&&r.bottom>=e.clientY)return}for(const r of t.children)if(r.getBoundingClientRect().bottom>=e.clientY){if(r===a||(a==null||a.remove(),r===n||r.previousElementSibling===n))return;t.insertBefore(a??ke(n),r);return}a==null||a.remove(),t.lastElementChild!==n&&t.append(a??ke(n))}function Ie(e){const n=document.createElement("div");return n.classList.add("column-placeholder"),n.style.width=`${e.offsetWidth}px`,n.style.height=`${e.offsetHeight}px`,n}function Me(e){if(!e.dataTransfer.types.includes("column"))return;const n=document.getElementById("board-container"),o=document.getElementById("dragged-column");if(!o)return;const t=n.querySelector(".column-placeholder"),a=Array.from(n.querySelectorAll(".task-column:not(#dragged-column)"));for(const r of a){const d=r.getBoundingClientRect(),s=d.left+d.width/2;if(e.clientX<s){if(t&&t.nextElementSibling===r)return;t==null||t.remove(),n.insertBefore(Ie(o),r);return}}t==null||t.remove(),n.appendChild(Ie(o))}let Ce=!1;function U(e=null){document.querySelectorAll(".column-menu").forEach(n=>{e&&n===e||n.classList.add("hidden")})}function At(e){const n=document.createElement("li");n.classList.add("task"),n.draggable=!0,n.dataset.taskId=e.id,n.setAttribute("role","listitem"),n.setAttribute("aria-label",`Task: ${e.title||e.text||"Untitled"}`);const o=document.createElement("div");o.classList.add("task-labels"),o.setAttribute("aria-label","Task labels");const t=I();e.labels&&e.labels.length>0&&e.labels.forEach(y=>{const v=t.find(T=>T.id===y);if(v){const T=document.createElement("span");T.classList.add("task-label"),T.style.backgroundColor=v.color,T.textContent=v.name,o.appendChild(T)}});const a=document.createElement("div");a.classList.add("task-header");const r=document.createElement("div");r.classList.add("task-title"),r.setAttribute("role","button"),r.setAttribute("tabindex","0");const d=typeof e.text=="string"?e.text:"";r.textContent=typeof e.title=="string"&&e.title.trim()!==""?e.title:d,r.addEventListener("click",()=>re(e.id)),r.addEventListener("keydown",y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),re(e.id))});const s=document.createElement("div");s.classList.add("task-actions");const l=document.createElement("button");l.classList.add("delete-task-btn"),l.setAttribute("aria-label","Delete task"),l.type="button";const i=document.createElement("span");i.dataset.lucide="trash-2",i.setAttribute("aria-hidden","true"),l.appendChild(i),l.addEventListener("click",async y=>{y.stopPropagation(),await oe({title:"Delete Task",message:"Are you sure you want to delete this task?",confirmText:"Delete"})&&at(e.id)&&$()}),s.appendChild(l),a.appendChild(r),a.appendChild(s);const u=typeof e.description=="string"?e.description.trim():"",c=document.createElement("div");c.classList.add("task-description"),c.textContent=u,c.style.display=u?"block":"none",c.addEventListener("click",()=>re(e.id));const f=document.createElement("div");f.classList.add("task-meta");const m=typeof e.priority=="string"?e.priority:"medium",p=document.createElement("span");p.classList.add("task-priority",`priority-${m}`),p.textContent=m,p.setAttribute("aria-label",`Priority: ${m}`);const g=typeof e.dueDate=="string"?e.dueDate.trim():"",S=document.createElement("span");if(S.classList.add("task-date"),!g)S.textContent="No due date";else{const y=g.includes("T")?g:`${g}T00:00:00`,v=new Date(y);S.textContent=Number.isNaN(v.getTime())?g:v.toLocaleDateString()}return f.appendChild(p),f.appendChild(S),n.appendChild(a),n.appendChild(c),n.appendChild(o),n.appendChild(f),n}function _t(e){const n=document.createElement("article");n.classList.add("task-column"),n.dataset.column=e.id,n.draggable=!1,n.setAttribute("aria-labelledby",`column-title-${e.id}`),e!=null&&e.color&&n.style.setProperty("--column-accent",e.color);const o=document.createElement("button");o.classList.add("column-drag-handle"),o.type="button",o.setAttribute("aria-label","Drag to reorder column");const t=document.createElement("span");t.dataset.lucide="grip-vertical",t.setAttribute("aria-hidden","true"),o.appendChild(t),o.title="Drag to reorder";const a=document.createElement("header");a.classList.add("column-header");const r=document.createElement("h2");r.id=`column-title-${e.id}`,r.textContent=e.name;const d=document.createElement("span");d.classList.add("task-counter"),d.dataset.columnId=e.id,d.textContent="0",d.setAttribute("aria-label","Task count");const s=document.createElement("div");s.classList.add("column-actions");const l=document.createElement("button");l.classList.add("add-task-btn-icon"),l.type="button",l.setAttribute("aria-label",`Add task to ${e.name}`);const i=document.createElement("span");i.dataset.lucide="plus",i.setAttribute("aria-hidden","true"),l.appendChild(i),l.title="Add task",l.addEventListener("click",()=>ht(e.id));const u=document.createElement("div");u.classList.add("column-menu-wrapper");const c=document.createElement("button");c.classList.add("column-menu-btn"),c.type="button",c.setAttribute("aria-haspopup","menu"),c.setAttribute("aria-expanded","false"),c.setAttribute("aria-label",`${e.name} column menu`);const f=document.createElement("span");f.dataset.lucide="ellipsis-vertical",f.setAttribute("aria-hidden","true"),c.appendChild(f),c.title="Column menu";const m=document.createElement("div");m.classList.add("column-menu","hidden"),m.setAttribute("role","menu");const p=document.createElement("button");p.classList.add("column-menu-item"),p.type="button",p.setAttribute("role","menuitem");const g=document.createElement("span");g.dataset.lucide="pencil",g.setAttribute("aria-hidden","true"),p.appendChild(g);const S=document.createTextNode(" Edit");p.appendChild(S),p.title="Edit column",p.addEventListener("click",R=>{R.stopPropagation(),U(),Lt(e.id)});const y=document.createElement("button");y.classList.add("column-menu-item","danger"),y.type="button",y.setAttribute("role","menuitem");const v=document.createElement("span");v.dataset.lucide="trash-2",v.setAttribute("aria-hidden","true"),y.appendChild(v);const T=document.createTextNode(" Delete");y.appendChild(T),y.title="Delete column",y.addEventListener("click",R=>{R.stopPropagation(),U(),(async()=>{if(x().length<=1){await $e({title:"Cannot Delete Column",message:"Cannot delete the last column."});return}const be=D().filter(Je=>Je.column===e.id),Ee=e!=null&&e.name?`"${e.name}"`:"this column",Ve=be.length>0?`Delete ${Ee}? This will also delete ${be.length} task(s).`:`Delete ${Ee}?`;await oe({title:"Delete Column",message:Ve,confirmText:"Delete"})&&ct(e.id)&&$()})()}),m.appendChild(p),m.appendChild(y),c.addEventListener("click",R=>{R.stopPropagation();const ye=!m.classList.contains("hidden");U(),ye?c.setAttribute("aria-expanded","false"):(m.classList.remove("hidden"),c.setAttribute("aria-expanded","true"))}),u.appendChild(c),u.appendChild(m),s.appendChild(l),s.appendChild(u),a.appendChild(o),a.appendChild(r),a.appendChild(d),a.appendChild(s);const J=document.createElement("ul");return J.classList.add("tasks"),J.setAttribute("role","list"),J.setAttribute("aria-label",`Tasks in ${e.name}`),n.appendChild(a),n.appendChild(J),n}function Ot(){const e=x(),n=document.getElementById("task-column");n.innerHTML="",e.forEach(o=>{const t=document.createElement("option");t.value=o.id,t.textContent=o.name,n.appendChild(t)})}function $(){const e=x(),n=D(),o=document.getElementById("board-container");o.innerHTML="",[...e].sort((a,r)=>(a.order??0)-(r.order??0)).forEach(a=>{const r=_t(a);o.appendChild(r);const d=r.querySelector(".tasks"),s=r.querySelector(".task-counter"),l=n.filter(i=>i.column===a.id).sort((i,u)=>(i.order??0)-(u.order??0));if(l.forEach(i=>{d.appendChild(At(i))}),s.textContent=l.length,l.length>12){r.classList.add("has-hidden-tasks");const i=document.createElement("button");i.classList.add("show-all-tasks-btn"),i.type="button";const u=l.length;i.textContent=`Show all tasks (${u})`,i.addEventListener("click",()=>{d.classList.toggle("expanded"),i.textContent=d.classList.contains("expanded")?"Hide extra tasks":`Show all tasks (${u})`}),r.appendChild(i)}}),St(),wt(),Dt(),Ot(),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons(),Ce||(Ce=!0,document.addEventListener("click",()=>U()),document.addEventListener("keydown",a=>{a.key==="Escape"&&U()}))}const O=Object.freeze(Object.defineProperty({__proto__:null,renderBoard:$},Symbol.toStringTag,{value:"Module"}));function ge(e){return typeof e=="string"&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(e.trim())}const Pt=new Set(["low","medium","high"]);function Ue(e){const n=(e||"").toString().trim().toLowerCase();return Pt.has(n)?n:"medium"}function ze(e){const n=(e||"").toString().trim();return n.length>=10&&n.includes("T")?n.slice(0,10):n}function Nt(e){const n=typeof(e==null?void 0:e.text)=="string"?e.text:"",o=typeof(e==null?void 0:e.title)=="string"?e.title:n,t=typeof(e==null?void 0:e.description)=="string"?e.description:"",a=ze((e==null?void 0:e.dueDate)??(e==null?void 0:e["due-date"]));return{...e,title:o.toString().trim(),description:t.toString().trim(),priority:Ue(e==null?void 0:e.priority),dueDate:a}}function qt(e){if(!Array.isArray(e))return null;const n=e.map(t=>{const a=typeof(t==null?void 0:t.id)=="string"?t.id:String((t==null?void 0:t.id)??""),r=typeof(t==null?void 0:t.text)=="string"?t.text:String((t==null?void 0:t.text)??""),d=typeof(t==null?void 0:t.title)=="string"?t.title:r,s=typeof(t==null?void 0:t.description)=="string"?t.description:String((t==null?void 0:t.description)??""),l=Ue(t==null?void 0:t.priority),i=typeof(t==null?void 0:t.dueDate)=="string"?t.dueDate:typeof(t==null?void 0:t["due-date"])=="string"?t["due-date"]:String((t==null?void 0:t.dueDate)??(t==null?void 0:t["due-date"])??""),u=ze(i),c=typeof(t==null?void 0:t.column)=="string"?t.column:String((t==null?void 0:t.column)??""),f=Array.isArray(t==null?void 0:t.labels)?t.labels.map(g=>typeof g=="string"?g:String(g)):[],m=Number.isFinite(t==null?void 0:t.order)?t.order:void 0,p=typeof(t==null?void 0:t.creationDate)=="string"?t.creationDate:void 0;return{id:a.trim(),title:d.trim(),description:s.trim(),priority:l,dueDate:u.trim(),column:c.trim(),...m!==void 0?{order:m}:{},...p?{creationDate:p}:{},labels:f}});return n.every(t=>t.id&&t.title&&t.column)?n:null}function $t(e){if(!Array.isArray(e))return null;const n=e.map(t=>{const a=typeof(t==null?void 0:t.id)=="string"?t.id:String((t==null?void 0:t.id)??""),r=typeof(t==null?void 0:t.name)=="string"?t.name:String((t==null?void 0:t.name)??""),d=Number.isFinite(t==null?void 0:t.order)?t.order:void 0,s=ge(t==null?void 0:t.color)?t.color.trim():"#3b82f6";return{id:a.trim(),name:r.trim(),color:s,...d!==void 0?{order:d}:{}}});return n.every(t=>t.id&&t.name)?n:null}function Rt(e){if(!Array.isArray(e))return null;const n=e.map(t=>{const a=typeof(t==null?void 0:t.id)=="string"?t.id:String((t==null?void 0:t.id)??""),r=typeof(t==null?void 0:t.name)=="string"?t.name:String((t==null?void 0:t.name)??""),d=ge(t==null?void 0:t.color)?t.color.trim():"#3b82f6";return{id:a.trim(),name:r.trim(),color:d}});return n.every(t=>t.id&&t.name&&t.color)?n:null}function Mt(){const e=D().map(Nt),n=x().map(l=>({...l,color:ge(l==null?void 0:l.color)?l.color.trim():"#3b82f6"})),o=I(),a=JSON.stringify({columns:n,tasks:e,labels:o},null,2),r=new Blob([a],{type:"application/json"}),d=URL.createObjectURL(r),s=document.createElement("a");s.href=d,s.download=`kanban-board-${new Date().toISOString()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(d)}function Ut(e){const n=new FileReader;n.onload=async o=>{try{const t=JSON.parse(o.target.result);let a,r,d;if(Array.isArray(t))a=t,r=x(),d=I();else if(t.tasks&&t.columns)a=t.tasks,r=t.columns,d=t.labels||I();else{alert("Invalid JSON file format");return}const s=qt(a),l=$t(r),i=d?Rt(d):null;if(!s||!l||d&&!i){alert("Invalid data structure");return}V(l),N(s),i&&ne(i);const{renderBoard:u}=await _(async()=>{const{renderBoard:c}=await Promise.resolve().then(()=>O);return{renderBoard:c}},void 0);u(),alert("Board imported successfully!")}catch(t){alert("Error parsing JSON file: "+t.message)}},n.readAsText(e)}const He="kanban-theme";function zt(){const e=localStorage.getItem(He);return e==="light"||e==="dark"?e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Be(e){document.documentElement.dataset.theme=e}function xe(e){const n=document.getElementById("theme-toggle-btn");if(!n)return;const o=e==="dark"?"light":"dark",t=o==="dark"?"Dark":"Light",a=o==="dark"?"moon":"sun";n.setAttribute("aria-pressed",String(e==="dark"));const r=n.querySelector("span[data-lucide]");r&&r.setAttribute("data-lucide",a);const d=Array.from(n.childNodes).filter(s=>s.nodeType===Node.TEXT_NODE);for(const s of d)s.remove();n.appendChild(document.createTextNode(` ${t}`)),window.lucide&&typeof window.lucide.createIcons=="function"&&window.lucide.createIcons()}function Ht(){const e=zt();Be(e),xe(e);const n=document.getElementById("theme-toggle-btn");n&&n.addEventListener("click",()=>{const t=(document.documentElement.dataset.theme==="dark"?"dark":"light")==="dark"?"light":"dark";Be(t),localStorage.setItem(He,t),xe(t)})}function Vt(e){return(typeof(e==null?void 0:e.name)=="string"?e.name.trim():"")||"Untitled board"}function Se(e){const n=C(),o=B();e.innerHTML="",n.forEach(t=>{const a=document.createElement("option");a.value=t.id,a.textContent=Vt(t),e.appendChild(a)}),o&&(e.value=o)}function ie(){const e=document.getElementById("brand-text")||document.querySelector(".brand-text");e&&(e.textContent=De())}function Jt(){h();const e=document.getElementById("board-select"),n=document.getElementById("new-board-btn");!e||!n||(Se(e),ie(),e.addEventListener("change",()=>{const o=e.value;if(!o)return;G(o),ie(),$();const t=document.getElementById("board-controls-menu"),a=document.getElementById("desktop-menu-btn");t==null||t.classList.remove("show"),a==null||a.setAttribute("aria-expanded","false")}),n.addEventListener("click",()=>{const o=window.prompt("New board name:");if(o===null)return;const t=o.trim();if(!t){alert("Board name cannot be empty.");return}const a=Ge(t);G(a.id),Se(e),ie(),$()}))}document.addEventListener("DOMContentLoaded",()=>{Ht(),Jt(),xt(),document.getElementById("export-btn").addEventListener("click",Mt),document.getElementById("import-btn").addEventListener("click",()=>{document.getElementById("import-file").click()}),document.getElementById("import-file").addEventListener("change",o=>{const t=o.target.files[0];t&&Ut(t),o.target.value=""});const e=document.getElementById("desktop-menu-btn"),n=document.getElementById("board-controls-menu");e&&n&&(e.addEventListener("click",o=>{o.stopPropagation();const t=e.getAttribute("aria-expanded")==="true";n.classList.toggle("show"),e.setAttribute("aria-expanded",String(!t)),document.querySelectorAll(".column-menu").forEach(a=>a.classList.add("hidden"))}),n.addEventListener("click",o=>{o.target.closest("select, option, input, textarea, label")||!o.target.closest('button, a, [role="menuitem"]')||(n.classList.remove("show"),e.setAttribute("aria-expanded","false"))}),document.addEventListener("click",o=>{!n.contains(o.target)&&!e.contains(o.target)&&(n.classList.remove("show"),e.setAttribute("aria-expanded","false"))})),window.addEventListener("beforeunload",o=>{const t="Your board data is stored in browser localStorage. Please export to a JSON file to save your work before closing.";return o.preventDefault(),o.returnValue=t,t}),$()});
