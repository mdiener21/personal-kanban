import{q as K,m as U,r as W,f as z,n as G,l as P}from"./theme-BHSURPZY.js";import"./vendor-pJTqpwCg.js";function R(t){const e=(t||"").toString().trim();return e&&e.length>=10?e.slice(0,10):""}function v(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${o}`}function T(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${e}-${a}`}function j(t){const e=new Date(t.getFullYear(),t.getMonth(),1);try{return new Intl.DateTimeFormat(void 0,{month:"long",year:"numeric"}).format(e)}catch{return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}}function H(t,e){const a=[],o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate());for(;o<=n;)a.push(new Date(o)),o.setDate(o.getDate()+1);return a}function F(t){return(t.getDay()+6)%7}function J(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Q(t){return new Date(t.getFullYear(),t.getMonth()+1,0)}function $(t){const e=t?.dueDate??t?.["due-date"]??"";return R(e)}function k(t){const e=typeof t?.title=="string"?t.title.trim():"";return e||(typeof t?.text=="string"?t.text.trim():"")||"Untitled task"}function V(t){return t?t?.column==="done"?!0:(t?.doneDate??"").toString().trim().length>0:!1}function B(t,e){const a=$(t);return!a||a.length<10||!e||e.length<10||V(t)?!1:a<e}function X(t,e,a){const o=T(e),n=new Map,m=new Map;for(const i of t||[]){const s=$(i);if(!s||s.length<10||!s.startsWith(o))continue;const h=n.get(s)||[];h.push(i),n.set(s,h),B(i,a)&&m.set(s,(m.get(s)||0)+1)}return{tasksByDate:n,overdueCountByDate:m}}function Z({tasks:t,monthDate:e,boardId:a}){const o=document.getElementById("calendar-grid"),n=document.getElementById("calendar-month-label"),m=document.getElementById("calendar-list-title"),i=document.getElementById("calendar-list");if(!o||!n||!m||!i)return;const s=J(e),h=Q(e),D=v(new Date),{tasksByDate:x,overdueCountByDate:Y}=X(t,e,D),L=T(e);let E=D.startsWith(L)?D:v(s);const I=()=>{const f=(x.get(E)||[]).slice();if(f.sort((r,c)=>k(r).localeCompare(k(c))),m.textContent=`Tasks due ${E} (${f.length})`,i.textContent="",f.length===0){const r=document.createElement("li");r.className="rpt-due-empty",r.textContent="No tasks due.",i.appendChild(r);return}for(const r of f){const c=document.createElement("li");c.className="rpt-due-item";const p=B(r,D);p&&c.classList.add("is-overdue");const d=document.createElement("a");d.className="rpt-due-tasklink",p&&d.classList.add("is-overdue");const M=(r?.id||"").toString(),C=(a||"").toString(),g=new URLSearchParams;g.set("openTaskId",M),C&&g.set("openTaskBoardId",C),d.href=`./index.html?${g.toString()}`,d.textContent=k(r),c.appendChild(d),i.appendChild(c)}},N=()=>{n.textContent=j(e),o.textContent="";const f=F(s),r=new Date(s.getFullYear(),s.getMonth(),s.getDate()-f),c=F(h),p=new Date(h.getFullYear(),h.getMonth(),h.getDate()+(6-c)),d=document.createDocumentFragment(),M=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];for(const g of M){const l=document.createElement("div");l.className="rpt-due-dow",l.textContent=g,d.appendChild(l)}const C=H(r,p);for(const g of C){const l=v(g),y=x.get(l)?.length||0,b=Y.get(l)||0,O=g.getMonth()!==e.getMonth(),q=l===D,u=document.createElement("button");u.type="button",u.className="rpt-due-day",O&&u.classList.add("is-outside"),q&&u.classList.add("is-today"),u.dataset.date=l,u.setAttribute("aria-pressed",l===E?"true":"false"),u.title=b>0?`${l}: ${y} task${y===1?"":"s"} due (${b} overdue)`:`${l}: ${y} task${y===1?"":"s"} due`;const S=document.createElement("div");if(S.className="rpt-due-num",S.textContent=String(g.getDate()),u.appendChild(S),y>0){const w=document.createElement("div");w.className="rpt-due-count",b>0&&w.classList.add("is-overdue"),w.textContent=String(y),u.appendChild(w)}d.appendChild(u)}o.appendChild(d)},A=f=>{const r=f?.target,c=r instanceof Element?r.closest("button.rpt-due-day"):null,p=c?.dataset?.date;p&&(E=p,o.querySelectorAll('button.rpt-due-day[aria-pressed="true"]').forEach(d=>d.setAttribute("aria-pressed","false")),c.setAttribute("aria-pressed","true"),I())};o.dataset.bound||(o.addEventListener("click",A),o.dataset.bound="true"),N(),I()}function _(){K(),U(),W();const t=z(),e=G(),a=document.getElementById("calendar-board-badge");a&&(a.textContent=t.slice(0,2).toUpperCase());const o=P();let n=new Date;n=new Date(n.getFullYear(),n.getMonth(),1);const m=document.getElementById("calendar-prev"),i=document.getElementById("calendar-next"),s=()=>{Z({tasks:o,monthDate:n,boardId:e})};m?.addEventListener("click",()=>{n=new Date(n.getFullYear(),n.getMonth()-1,1),s()}),i?.addEventListener("click",()=>{n=new Date(n.getFullYear(),n.getMonth()+1,1),s()}),s()}_();
